<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelatine Network | Command Center</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --primary: #FFD700;
            /* Gold */
            --neon-pink: #FF007F;
            --neon-blue: #00F3FF;
            --text: #ffffff;
        }

        body {
            background-color: var(--bg);
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255, 0, 127, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.15) 0%, transparent 40%);
            color: var(--text);
            font-family: 'Space Grotesk', sans-serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 480px;
            position: relative;
            z-index: 1;
        }

        /* Animations */
        @keyframes wobble {

            0%,
            100% {
                transform: scale3d(1, 1, 1);
            }

            50% {
                transform: scale3d(1.1, 0.9, 1);
            }
        }

        .logo {
            font-size: 4em;
            display: inline-block;
            animation: wobble 3s infinite ease-in-out;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2em;
            margin: 0;
            background: linear-gradient(90deg, var(--primary), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Glass Cards */
        .card {
            background: var(--glass);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .section-title {
            font-size: 0.9em;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--neon-blue);
            letter-spacing: 1.5px;
        }

        /* Buttons */
        button {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: none;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Space Grotesk', sans-serif;
            text-transform: uppercase;
        }

        button:active {
            transform: scale(0.98);
        }

        .btn-connect {
            background: linear-gradient(45deg, var(--primary), #ffaa00);
            color: #000;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            margin-bottom: 15px;
        }

        .btn-connect:hover {
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .btn-token {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8em;
            padding: 10px;
        }

        .btn-token:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-action {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 20px;
        }

        .btn-action:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--neon-pink);
            color: var(--neon-pink);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Stats & Inputs */
        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-val {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.7em;
            opacity: 0.6;
            text-transform: uppercase;
        }

        .input-group {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        input {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2em;
            width: 100%;
            padding: 10px 0;
            outline: none;
            font-family: 'Space Grotesk', sans-serif;
        }

        .max-btn {
            color: var(--neon-blue);
            font-size: 0.8em;
            cursor: pointer;
            font-weight: bold;
        }

        /* Nav */
        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav a {
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-weight: bold;
            transition: 0.3s;
            padding-bottom: 5px;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .nav a.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #status {
            font-size: 0.8em;
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="logo-container">
            <span class="logo">üçÆ</span>
            <h1>Gelatine Network</h1>
            <div style="font-size: 0.8em; opacity: 0.7; letter-spacing: 3px; margin-top: 5px;">EST. 2026</div>
        </div>

        <div class="nav">
            <a href="index.html" class="active">Command Center</a>
            <a href="swap.html">Swap</a>
            <a href="jam.html">Jam Jar</a>
            <a href="mint.html">Jelly Heads</a>

        </div>

        <div class="card">
            <div class="section-header">
                <span>üîå</span> <span class="section-title">Network Setup</span>
            </div>
            <p style="text-align: center; font-size: 0.85em; opacity: 0.7; margin-top: -10px; margin-bottom: 15px;">
                New here? Click below to add the Chain and Tokens to your wallet.
            </p>

            <button class="btn-connect" onclick="addNetwork()">
                ‚ö° Add Gelatine Chain
            </button>

            <div
                style="text-align: center; font-size: 0.7em; text-transform: uppercase; opacity: 0.5; margin-bottom: 10px; letter-spacing: 1px;">
                Discover Assets
            </div>

            <div class="grid-3">
                <button class="btn-token" onclick="addToken('WJELLO')">
                    <span>üçÆ</span> Add WJELLO
                </button>
                <button class="btn-token" onclick="addToken('PUD')">
                    <span>üßÅ</span> Add PUD
                </button>
                <button class="btn-token" onclick="addToken('JAM')">
                    <span>üçì</span> Add JAM
                </button>
            </div>
        </div>

        <div class="card">
            <div class="section-header">
                <span>üéÅ</span> <span class="section-title">Free Resources</span>
            </div>
            <div class="grid-2">
                <button class="btn-action" onclick="claimGift()">
                    <span style="font-size: 1.5em;">üéâ</span>
                    <span>Claim 1000 JELLO</span>
                    <span style="font-size: 0.6em; opacity: 0.7;">WELCOME BONUS</span>
                </button>
                <button class="btn-action" onclick="claimFaucet()">
                    <span style="font-size: 1.5em;">üíß</span>
                    <span>Claim 20 JELLO</span>
                    <span style="font-size: 0.6em; opacity: 0.7;">DAILY FAUCET</span>
                </button>
            </div>
        </div>

        <div class="card">
            <div class="section-header">
                <span>‚ùÑÔ∏è</span> <span class="section-title">The Fridge</span>
            </div>
            <p style="text-align: center; font-size: 0.9em; margin-top: -10px; opacity: 0.8; margin-bottom: 20px;">
                Stake <strong>PUD</strong> to earn yield.
            </p>

            <div class="stat-grid grid-2" style="margin-bottom: 20px;">
                <div class="stat-box">
                    <span class="stat-val" id="liveApy">---%</span>
                    <div class="stat-label">Live APY</div>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="totalStaked">0</span>
                    <div class="stat-label">Total PUD Locked</div>
                </div>
            </div>

            <div
                style="background: linear-gradient(45deg, rgba(0,255,0,0.1), transparent); border: 1px solid #00ff0033; border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 20px;">
                <div class="stat-label" style="color: #4caf50;">Unclaimed Rewards</div>
                <div class="stat-val" id="earned"
                    style="color: #4caf50; font-size: 2em; text-shadow: 0 0 15px rgba(76, 175, 80, 0.4);">0.0000</div>
                <button onclick="getRewards()"
                    style="background: #4caf50; color: black; margin-top: 10px; padding: 10px; width: auto; padding-left: 30px; padding-right: 30px;">Claim
                    PUD</button>
            </div>

            <div
                style="display: flex; justify-content: space-between; font-size: 0.8em; margin-bottom: 5px; opacity: 0.7;">
                <span>Stake Amount</span>
                <span>Bal: <span id="walletBal">0</span> PUD</span>
            </div>

            <div class="input-group">
                <input type="number" id="stakeAmount" placeholder="0.0">
                <span class="max-btn" onclick="setMax()">MAX</span>
            </div>

            <div class="grid-2">
                <button onclick="handleStake()" style="background: var(--text); color: black;">Stake PUD</button>
                <button onclick="handleWithdraw()"
                    style="background: transparent; border: 1px solid var(--border); color: white;">Unstake</button>
            </div>
        </div>

        <div id="status">System Status: Online</div>
    </div>

    <script>
        // --- ‚öôÔ∏è CONFIGURATION ---
        const ADDR = {
            FRIDGE: "0x5E1a69F97Be2203C301022eCEaED98C4A30F26ab",
            PUD: "0xdDD5e1b52670667Fd7F38f8B7F8CcBc007fB9B97",
            WJELLO: "0xd5d395383Edddb48643bC19870308918670Fc80D",
            JAM: "0xcA2144D681137eD0F7A4CCb941fe2d834D1A78bb",
            FAUCET: "0x9Bf32d7AcA36F55Fa077eac1d7718f2F710577F1",
            GIFT: "0xa58ea0b18D470D73a5628Ff768edEAa21D7bd938"
        };
        const RPC_URL = "https://rpc.pine.ink";
        const CHAIN_ID_DEC = 61564n;
        const CHAIN_ID_HEX = "0xF07C";

        // Standard ABIs
        const ERC20_ABI = ["function balanceOf(address) view returns (uint256)", "function approve(address, uint256) returns (bool)"];
        const FRIDGE_ABI = [
            "function stake(uint256)", "function withdraw(uint256)", "function getReward()",
            "function earned(address) view returns (uint256)", "function totalSupply() view returns (uint256)",
            "function rewardRate() view returns (uint256)"
        ];
        const CLAIM_ABI = ["function claim()", "function claimGift()"];

        let provider, signer;

        async function init() {
            if (!window.ethereum) return updateStatus("Please install MetaMask!");
            provider = new ethers.BrowserProvider(window.ethereum);

            // Auto-check network but don't force popup immediately
            try {
                const net = await provider.getNetwork();
                if (net.chainId === CHAIN_ID_DEC) {
                    signer = await provider.getSigner();
                    updateStatus("üü¢ Wallet Connected");
                    refreshData();
                    setInterval(refreshData, 6000);
                } else {
                    updateStatus("üü° Wrong Network");
                }
            } catch (e) { updateStatus("üü° Waiting for Connection..."); }
        }

        async function addNetwork() {
            if (!window.ethereum) return alert("MetaMask not found!");
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: CHAIN_ID_HEX,
                        chainName: 'Gelatine Network',
                        nativeCurrency: { name: 'JELLO', symbol: 'JELLO', decimals: 18 },
                        rpcUrls: [RPC_URL]
                    }]
                });
                // After adding, try to init again
                init();
            } catch (error) { alert("Error: " + error.message); }
        }

        async function addToken(symbol) {
            if (!window.ethereum) return alert("Connect Wallet first!");

            // Map symbol to address
            const tokenAddress = ADDR[symbol];
            if (!tokenAddress) return alert("Unknown Token");

            try {
                await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: tokenAddress,
                            symbol: symbol,
                            decimals: 18,
                        },
                    },
                });
            } catch (error) { console.error(error); }
        }

        async function refreshData() {
            if (!signer) return;
            const user = await signer.getAddress();
            const fridge = new ethers.Contract(ADDR.FRIDGE, FRIDGE_ABI, signer);
            const pud = new ethers.Contract(ADDR.PUD, ERC20_ABI, signer);

            // Fetch Data
            try {
                const rate = await fridge.rewardRate();
                const total = await fridge.totalSupply();
                const earned = await fridge.earned(user);
                const bal = await pud.balanceOf(user);

                // APY Calc
                const secondsInYear = 31536000n;
                if (total > 0n) {
                    const annualRewards = rate * secondsInYear;
                    const apy = (annualRewards * 100n) / total;
                    document.getElementById('liveApy').innerText = apy.toString() + "%";
                } else {
                    document.getElementById('liveApy').innerText = "‚àû%";
                }

                document.getElementById('earned').innerText = parseFloat(ethers.formatEther(earned)).toFixed(4);
                document.getElementById('totalStaked').innerText = formatCompact(total);
                document.getElementById('walletBal').innerText = Math.round(ethers.formatEther(bal));
            } catch (e) { console.log("Data fetch error", e); }
        }

        function formatCompact(bgInt) {
            const num = parseFloat(ethers.formatEther(bgInt));
            return Intl.NumberFormat('en-US', { notation: "compact", maximumFractionDigits: 1 }).format(num);
        }

        // --- ACTIONS ---
        async function claimGift() {
            if (!signer) return addNetwork();
            const gift = new ethers.Contract(ADDR.GIFT, CLAIM_ABI, signer);
            try { const tx = await gift.claimGift(); await tx.wait(); alert("Success! 1000 JELLO received."); }
            catch (e) { alert("Error: Already claimed or Empty!"); }
        }

        async function claimFaucet() {
            if (!signer) return addNetwork();
            const faucet = new ethers.Contract(ADDR.FAUCET, CLAIM_ABI, signer);
            try { const tx = await faucet.claim(); await tx.wait(); alert("Success! 20 JELLO received."); }
            catch (e) { alert("Error: Come back later."); }
        }

        async function handleStake() {
            if (!signer) return addNetwork();
            const amt = document.getElementById('stakeAmount').value;
            if (!amt) return;
            const wei = ethers.parseEther(amt);
            const pud = new ethers.Contract(ADDR.PUD, ERC20_ABI, signer);
            const fridge = new ethers.Contract(ADDR.FRIDGE, FRIDGE_ABI, signer);
            try {
                updateStatus("‚è≥ Approving...");
                const tx1 = await pud.approve(ADDR.FRIDGE, wei); await tx1.wait();
                updateStatus("‚ùÑÔ∏è Staking...");
                const tx2 = await fridge.stake(wei); await tx2.wait();
                alert("Staked successfully!");
                updateStatus("üü¢ Online");
                refreshData();
            } catch (e) { alert("Error staking"); updateStatus("üî¥ Error"); }
        }

        async function handleWithdraw() {
            if (!signer) return addNetwork();
            const amt = prompt("Amount to unstake?");
            if (!amt) return;
            const fridge = new ethers.Contract(ADDR.FRIDGE, FRIDGE_ABI, signer);
            try { const tx = await fridge.withdraw(ethers.parseEther(amt)); await tx.wait(); refreshData(); }
            catch (e) { alert("Error withdrawing"); }
        }

        async function getRewards() {
            if (!signer) return addNetwork();
            const fridge = new ethers.Contract(ADDR.FRIDGE, FRIDGE_ABI, signer);
            try { const tx = await fridge.getReward(); await tx.wait(); refreshData(); } catch (e) { }
        }

        async function setMax() {
            if (!signer) return;
            const pud = new ethers.Contract(ADDR.PUD, ERC20_ABI, signer);
            const bal = await pud.balanceOf(await signer.getAddress());
            document.getElementById('stakeAmount').value = ethers.formatEther(bal);
        }

        function updateStatus(m) { document.getElementById('status').innerText = m; }

        window.onload = init;
    </script>
</body>

</html>